<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
    <meta charset="utf-8" />
    <title>Leaflet.SimpleLocate - Demo (Kat ve KapÄ± Bulma)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        crossorigin=""
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script src="dist/leaflet-simple-locate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/low-pass-filter@1.0.0/dist/low-pass-filter.min.js"></script>

    <link rel="stylesheet" href="examples/demo.css" />
    <link rel="stylesheet" href="examples/style.css" />
    <link rel="stylesheet" href="examples/location-styles.css" />
    
    <style>
        .filter-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            width: 220px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            font-size: 13px;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        
        .panel-title {
            font-weight: bold;
            font-size: 14px;
            color: #333;
        }
        
        .toggle-button {
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: #f5f5f5;
            color: #555;
            transition: all 0.2s;
        }
        
        .toggle-button:hover {
            background-color: #e0e0e0;
            color: #333;
        }
        
        .toggle-button i {
            font-size: 16px;
        }
        
        .filter-panel.collapsed {
            width: auto;
            height: auto;
            padding: 5px;
        }
        
        .filter-panel.collapsed .filter-content {
            display: none;
        }
        
        .filter-panel.collapsed .panel-title {
            display: none;
        }
        
        .filter-panel.collapsed .panel-header {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .filter-group {
            margin-bottom: 8px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 2px;
            font-weight: 500;
            color: #555;
            font-size: 12px;
        }
        
        .info-icon {
            margin-left: 3px;
            cursor: pointer;
            color: #2196F3;
            font-size: 14px;
            font-weight: bold;
        }
        
        .range-slider {
            width: 100%;
            margin: 3px 0;
            height: 8px;
        }
        
        .range-value {
            font-weight: bold;
            color: #2196F3;
            font-size: 11px;
        }
        
        .filter-actions {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
        }
        
        .filter-actions button {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            background: #2196F3;
            color: white;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 12px;
        }
        
        .filter-actions button:hover {
            background: #0b7dda;
        }
        
        .filter-actions button.reset {
            background: #f44336;
        }
        
        .filter-actions button.reset:hover {
            background: #d32f2f;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1200;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 15px;
            border-radius: 8px;
            max-width: 70%;
            width: 300px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            text-align: center;
        }
        
        .modal-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            font-size: 16px;
        }
        
        .modal-description {
            margin-bottom: 15px;
            line-height: 1.4;
            color: #555;
            font-size: 14px;
        }
        
        .modal-button {
            padding: 8px 15px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            font-size: 12px;
        }
        
        .checkbox-group input {
            margin-right: 6px;
        }
        
        .toggler {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 999;
            background: white;
            padding: 6px;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            cursor: pointer;
            display: none;
            font-size: 13px;
        }
        
        /* Font Awesome benzeri ikonlar */
        @font-face {
            font-family: 'Material Icons';
            font-style: normal;
            font-weight: 400;
            src: url(https://fonts.gstatic.com/s/materialicons/v140/flUhRq6tzZclQEJ-Vdg-IuiaDsNc.woff2) format('woff2');
        }
        
        .material-icons {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }
        
        @media (max-width: 768px) {
            .filter-panel {
                width: 200px;
                font-size: 12px;
            }
            
            .modal-content {
                max-width: 85%;
                width: 280px;
            }
        }
        
        /* Status mesajÄ± stili */
        .status-message {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1100;
            background: rgba(76,175,80,0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            text-align: center;
            animation: fadeInOut 3s forwards;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; }
            10% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        /* Log Button */
        .log-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #2196F3;
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
        }
        
        .log-button:hover {
            background: #1976D2;
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
        }
        
        .log-button.active {
            background: #F44336;
        }
        
        .log-button .badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #FF5722;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 11px;
            font-weight: bold;
            min-width: 18px;
            text-align: center;
        }
        
        /* Bottom Sheet */
        .log-bottom-sheet {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
            z-index: 2000;
            max-height: 70vh;
            display: none;
            flex-direction: column;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }
        
        .log-bottom-sheet.open {
            display: flex;
            transform: translateY(0);
        }
        
        .log-sheet-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f5f5f5;
            border-radius: 20px 20px 0 0;
        }
        
        .log-sheet-title {
            font-weight: bold;
            font-size: 18px;
            color: #333;
        }
        
        .log-sheet-actions {
            display: flex;
            gap: 10px;
        }
        
        .log-sheet-actions button {
            background: none;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }
        
        .log-sheet-actions button.clear-btn {
            color: #F44336;
        }
        
        .log-sheet-actions button.clear-btn:hover {
            background: #ffebee;
        }
        
        .log-sheet-actions button.close-btn {
            color: #666;
        }
        
        .log-sheet-actions button.close-btn:hover {
            background: #f0f0f0;
        }
        
        .log-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .log-entry {
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
            background: #f9f9f9;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .log-entry.jump {
            border-left-color: #F44336;
            background: #ffebee;
        }
        
        .log-entry.large_change {
            border-left-color: #FF9800;
            background: #fff3e0;
        }
        
        .log-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }
        
        .log-entry-time {
            font-weight: bold;
            color: #666;
            font-size: 12px;
        }
        
        .log-entry-type {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .log-entry-type.position {
            background: #E3F2FD;
            color: #1976D2;
        }
        
        .log-entry-type.jump {
            background: #FFEBEE;
            color: #C62828;
        }
        
        .log-entry-type.large_change {
            background: #FFF3E0;
            color: #E65100;
        }
        
        .log-entry-data {
            color: #555;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-entry-data .coord {
            margin: 2px 0;
        }
        
        .log-entry-data .distance {
            color: #FF9800;
            font-weight: bold;
        }
        
        .log-entry-data .jump-info {
            color: #F44336;
            font-weight: bold;
        }
        
        .log-empty {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    
    <!-- Wei Ye Filtreleme Paneli -->
    <div id="filterPanel" class="filter-panel">
        <div class="panel-header">
            <div class="panel-title">Konum Filtreleme</div>
            <button id="togglePanel" class="toggle-button">
                <i class="material-icons">tune</i>
            </button>
        </div>
        
        <div class="filter-content">
            <div class="checkbox-group">
                <input type="checkbox" id="enableFiltering" checked>
                <label for="enableFiltering">Filtreleme <span class="info-icon" data-title="Filtreleme" data-info="Bu seÃ§enek tÃ¼m Wei Ye konum filtrelemesini aÃ§ar/kapatÄ±r.">â„¹</span></label>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="enableLowPassFilter" checked>
                <label for="enableLowPassFilter">Low Pass <span class="info-icon" data-title="Low Pass Filtre" data-info="Konum deÄŸiÅŸimlerini yumuÅŸatan temel bir filtredir. Ani GPS sÄ±Ã§ramalarÄ±nÄ± engeller.">â„¹</span></label>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="showJumpWarnings" checked>
                <label for="showJumpWarnings">UyarÄ±lar <span class="info-icon" data-title="SÄ±Ã§rama UyarÄ±larÄ±" data-info="GPS konumunda ani ve bÃ¼yÃ¼k deÄŸiÅŸiklikler tespit edildiÄŸinde ekranda uyarÄ± gÃ¶sterir.">â„¹</span></label>
            </div>
            
            <div class="filter-group">
                <label for="medianWindowSize">Medyan Pencere <span class="info-icon" data-title="Medyan Pencere Boyutu" data-info="Konum verilerinin son birkaÃ§ Ã¶lÃ§Ã¼mÃ¼nden ortanca deÄŸeri kullanÄ±r. BÃ¼yÃ¼k deÄŸerler daha Ã§ok yumuÅŸatÄ±r ancak tepki sÃ¼resini artÄ±rÄ±r ve gecikmeye sebep olabilir.">â„¹</span></label>
                <input type="range" id="medianWindowSize" min="2" max="10" value="3" class="range-slider">
                <span class="range-value">3</span>
            </div>
            
            <div class="filter-group">
                <label for="kalmanProcessNoise">Kalman Q <span class="info-icon" data-title="Kalman Ä°ÅŸlem GÃ¼rÃ¼ltÃ¼sÃ¼ (Q)" data-info="Kalman filtresinin iÅŸlem gÃ¼rÃ¼ltÃ¼sÃ¼ parametresidir. YÃ¼ksek deÄŸerler GPS verilerine daha Ã§ok gÃ¼venmeyi, dÃ¼ÅŸÃ¼k deÄŸerler ise daha stabil ancak daha geÃ§ tepki veren sonuÃ§larÄ± saÄŸlar.">â„¹</span></label>
                <input type="range" id="kalmanProcessNoise" min="0.001" max="0.2" value="0.05" step="0.001" class="range-slider">
                <span class="range-value">0.05</span>
            </div>
            
            <div class="filter-group">
                <label for="kalmanMeasurementNoise">Kalman R <span class="info-icon" data-title="Kalman Ã–lÃ§Ã¼m GÃ¼rÃ¼ltÃ¼sÃ¼ (R)" data-info="Kalman filtresinin Ã¶lÃ§Ã¼m gÃ¼rÃ¼ltÃ¼sÃ¼ parametresidir. YÃ¼ksek deÄŸerler Ã¶lÃ§Ã¼mlere daha az gÃ¼venmeyi ve daha yumuÅŸak ancak geciktirilmiÅŸ sonuÃ§larÄ± saÄŸlar. KapalÄ± alanlarda daha yÃ¼ksek deÄŸerler kullanÄ±lmasÄ± Ã¶nerilir.">â„¹</span></label>
                <input type="range" id="kalmanMeasurementNoise" min="0.01" max="1" value="0.2" step="0.01" class="range-slider">
                <span class="range-value">0.2</span>
            </div>
            
            <div class="filter-group">
                <label for="jumpThreshold">SÄ±Ã§rama EÅŸiÄŸi <span class="info-icon" data-title="SÄ±Ã§rama Tespit EÅŸiÄŸi" data-info="GPS sÄ±Ã§ramasÄ±nÄ±n tespit edilmesi iÃ§in gerekli minimum konum deÄŸiÅŸimi eÅŸiÄŸidir. YÃ¼ksek deÄŸerler daha az sÄ±Ã§rama tespiti yapar, dÃ¼ÅŸÃ¼k deÄŸerler kÃ¼Ã§Ã¼k sÄ±Ã§ramalarÄ± bile tespit eder. KapalÄ± alanlarda daha dÃ¼ÅŸÃ¼k deÄŸerler kullanÄ±lmasÄ± Ã¶nerilir.">â„¹</span></label>
                <input type="range" id="jumpThreshold" min="0.0001" max="0.001" value="0.0005" step="0.0001" class="range-slider">
                <span class="range-value">0.0005</span>
            </div>
            
            <div class="filter-group">
                <label for="lowPassFilterTau">Tau DeÄŸeri <span class="info-icon" data-title="Low Pass Filtre Tau DeÄŸeri" data-info="Low pass filtresinin zaman sabitidir. YÃ¼ksek tau deÄŸerleri (3.0) daha fazla yumuÅŸatma yapar ve hareketli nesnelerde gecikmeye neden olabilir. DÃ¼ÅŸÃ¼k tau deÄŸerleri (0.1-0.5) daha az yumuÅŸatÄ±r ama daha hÄ±zlÄ± tepki verir.">â„¹</span></label>
                <input type="range" id="lowPassFilterTau" min="0.1" max="3" value="0.5" step="0.1" class="range-slider">
                <span class="range-value">0.5</span>
            </div>
            
            <div class="filter-actions">
                <button id="applyFilters">Uygula</button>
                <button id="resetFilters" class="reset">SÄ±fÄ±rla</button>
            </div>
        </div>
    </div>
    
    <!-- Modal Dialog -->
    <div id="infoModal" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">Parametre Bilgisi</div>
            <div class="modal-description" id="modalDescription">
                Parametre hakkÄ±nda detaylÄ± aÃ§Ä±klama burada gÃ¶rÃ¼necek.
            </div>
            <button class="modal-button" id="closeModal">AnladÄ±m</button>
        </div>
    </div>
    
    <!-- Log Button -->
    <button id="logToggleButton" class="log-button" title="Konum LoglarÄ±">
        ðŸ“Š
        <span class="badge" id="logBadge" style="display: none;">0</span>
    </button>
    
    <!-- Log Bottom Sheet -->
    <div id="logBottomSheet" class="log-bottom-sheet">
        <div class="log-sheet-header">
            <div class="log-sheet-title">Konum LoglarÄ±</div>
            <div class="log-sheet-actions">
                <button class="clear-btn" id="clearLogsBtn">Temizle</button>
                <button class="close-btn" id="closeLogSheetBtn">âœ•</button>
            </div>
        </div>
        <div class="log-content" id="logContent">
            <div class="log-empty">HenÃ¼z log yok</div>
        </div>
    </div>
    
    <script src="dist/location-app.js"></script>
    
    <script>
        // Default parametreler - orijinal deÄŸerler
        const defaultFilters = {
            medianWindowSize: 3,
            kalmanProcessNoise: 0.05,
            kalmanMeasurementNoise: 0.2,
            jumpThreshold: 0.0005,
            lowPassFilterTau: 0.5,
            enableFiltering: true,
            enableLowPassFilter: true,
            showJumpWarnings: true
        };
        
        // Wei Ye filtreleme panel kontrolleri
































































































        const filterPanel = document.getElementById('filterPanel');
        const togglePanel = document.getElementById('togglePanel');
        const applyFilters = document.getElementById('applyFilters');
        const resetFilters = document.getElementById('resetFilters');
        const infoModal = document.getElementById('infoModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalDescription = document.getElementById('modalDescription');
        const closeModal = document.getElementById('closeModal');
        
        // Range slider larÄ±n deÄŸer gÃ¶stergeleri
        document.querySelectorAll('.range-slider').forEach(slider => {
            slider.addEventListener('input', function() {
                this.nextElementSibling.textContent = this.value;
            });
        });
        
        // Bilgi ikonu tÄ±klama olayÄ±
        document.querySelectorAll('.info-icon').forEach(icon => {
            icon.addEventListener('click', function() {
                const title = this.getAttribute('data-title');
                const info = this.getAttribute('data-info');
                
                modalTitle.textContent = title;
                modalDescription.textContent = info;
                infoModal.style.display = 'flex';
            });
        });
        
        // Modal kapatma
        closeModal.addEventListener('click', function() {
            infoModal.style.display = 'none';
        });
        
        // Modal dÄ±ÅŸÄ±na tÄ±klayÄ±nca da kapansÄ±n
        infoModal.addEventListener('click', function(e) {
            if (e.target === infoModal) {
                infoModal.style.display = 'none';
            }
        });
        
        // Panel toggle fonksiyonu
        togglePanel.addEventListener('click', function() {
            filterPanel.classList.toggle('collapsed');
            this.querySelector('i').textContent = filterPanel.classList.contains('collapsed') ? 'settings' : 'tune';
        });
        
        // Filtreleri uygula
        applyFilters.addEventListener('click', function() {
            const settings = {
                medianWindowSize: parseInt(document.getElementById('medianWindowSize').value),
                kalmanProcessNoise: parseFloat(document.getElementById('kalmanProcessNoise').value),
                kalmanMeasurementNoise: parseFloat(document.getElementById('kalmanMeasurementNoise').value),
                jumpThreshold: parseFloat(document.getElementById('jumpThreshold').value),
                lowPassFilterTau: parseFloat(document.getElementById('lowPassFilterTau').value),
                enableFiltering: document.getElementById('enableFiltering').checked,
                enableLowPassFilter: document.getElementById('enableLowPassFilter').checked,
                showJumpWarnings: document.getElementById('showJumpWarnings').checked
            };
            
            // SimpleLocate nesnesinin seÃ§eneklerini gÃ¼ncelle

            if (window.filterControl) {
                // TÃ¼m ayarlarÄ± gÃ¼ncelle
                Object.keys(settings).forEach(key => {

                    window.filterControl.options[key] = settings[key];
                });
                
                // Uygulama bilgisi
                showStatusMessage('Filtre ayarlarÄ± uygulandÄ±');
            } else {
                console.error('SimpleLocate kontrolÃ¼ henÃ¼z yÃ¼klenmemiÅŸ!');
                showStatusMessage('Hata: Kontrol yÃ¼klenemedi!', true);
            }
        });
        
        // Filtreleri sÄ±fÄ±rla
        resetFilters.addEventListener('click', function() {
            // Form elemanlarÄ±nÄ± varsayÄ±lan deÄŸerlere sÄ±fÄ±rla
            document.getElementById('medianWindowSize').value = defaultFilters.medianWindowSize;
            document.getElementById('kalmanProcessNoise').value = defaultFilters.kalmanProcessNoise;
            document.getElementById('kalmanMeasurementNoise').value = defaultFilters.kalmanMeasurementNoise;
            document.getElementById('jumpThreshold').value = defaultFilters.jumpThreshold;
            document.getElementById('lowPassFilterTau').value = defaultFilters.lowPassFilterTau;
            document.getElementById('enableFiltering').checked = defaultFilters.enableFiltering;
            document.getElementById('enableLowPassFilter').checked = defaultFilters.enableLowPassFilter;
            document.getElementById('showJumpWarnings').checked = defaultFilters.showJumpWarnings;
            
            // Range deÄŸer gÃ¶stergelerini gÃ¼ncelle
            document.querySelectorAll('.range-slider').forEach(slider => {
                slider.nextElementSibling.textContent = slider.value;
            });
            
            // VarsayÄ±lan ayarlarÄ± uygula

            if (window.filterControl) {
                Object.keys(defaultFilters).forEach(key => {

                    window.filterControl.options[key] = defaultFilters[key];
                });
                
                showStatusMessage('VarsayÄ±lan deÄŸerler yÃ¼klendi');
            } else {
                showStatusMessage('Hata: Kontrol yÃ¼klenemedi!', true);
            }
        });
        
        // Durum mesajÄ± gÃ¶sterme fonksiyonu
        function showStatusMessage(message, isError = false) {
            const notification = document.createElement('div');
            notification.className = 'status-message';
            notification.textContent = message;
            notification.style.backgroundColor = isError ? 'rgba(244,67,54,0.9)' : 'rgba(76,175,80,0.9)';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        // Loglama sistemi
        let logEnabled = false;
        const logToggleButton = document.getElementById('logToggleButton');
        const logBottomSheet = document.getElementById('logBottomSheet');
        const logContent = document.getElementById('logContent');
        const logBadge = document.getElementById('logBadge');
        const clearLogsBtn = document.getElementById('clearLogsBtn');
        const closeLogSheetBtn = document.getElementById('closeLogSheetBtn');
        
        // Log button toggle
        if (logToggleButton) {
            logToggleButton.addEventListener('click', function() {
                if (!logEnabled) {
                    // LoglamayÄ± baÅŸlat
                    if (window.filterControl) {
                        window.filterControl.setLoggingEnabled(true);
                        logEnabled = true;
                        logToggleButton.classList.add('active');
                        logBottomSheet.classList.add('open');
                        updateLogDisplay();
                    }
                } else {
                    // Bottom sheet'i aÃ§/kapat
                    logBottomSheet.classList.toggle('open');
                }
            });
        }
        
        // Close button
        if (closeLogSheetBtn) {
            closeLogSheetBtn.addEventListener('click', function() {
                logBottomSheet.classList.remove('open');
            });
        }
        
        // Clear logs button
        if (clearLogsBtn) {
            clearLogsBtn.addEventListener('click', function() {
                if (window.filterControl) {
                    window.filterControl.clearLogs();
                    updateLogDisplay();
                }
            });
        }
        
        // Log gÃ¼ncelleme fonksiyonu
        function updateLogDisplay() {
            if (!window.filterControl || !logContent) return;
            
            const logs = window.filterControl.getLogs();
            const jumpCount = logs.filter(log => log.type === 'jump').length;
            const largeChangeCount = logs.filter(log => log.type === 'large_change').length;
            const totalAlerts = jumpCount + largeChangeCount;
            
            // Badge gÃ¼ncelle
            if (logBadge) {
                if (totalAlerts > 0) {
                    logBadge.textContent = totalAlerts;
                    logBadge.style.display = 'block';
                } else {
                    logBadge.style.display = 'none';
                }
            }
            
            // Log iÃ§eriÄŸini gÃ¼ncelle
            if (logs.length === 0) {
                logContent.innerHTML = '<div class="log-empty">HenÃ¼z log yok</div>';
                return;
            }
            
            // Son 50 logu gÃ¶ster (performans iÃ§in)
            const displayLogs = logs.slice(-50).reverse();
            
            logContent.innerHTML = displayLogs.map(log => {
                const entryClass = log.type === 'jump' ? 'jump' : 
                                  log.type === 'large_change' ? 'large_change' : '';
                const typeClass = log.type === 'jump' ? 'jump' : 
                                 log.type === 'large_change' ? 'large_change' : 'position';
                
                let dataHtml = '';
                if (log.data) {
                    if (log.data.raw && log.data.filtered) {
                        dataHtml += `
                            <div class="coord">Ham: ${log.data.raw.lat.toFixed(6)}, ${log.data.raw.lng.toFixed(6)} (${log.data.raw.accuracy.toFixed(1)}m)</div>
                            <div class="coord">Filtre: ${log.data.filtered.lat.toFixed(6)}, ${log.data.filtered.lng.toFixed(6)} (${log.data.filtered.accuracy.toFixed(1)}m)</div>
                        `;
                    }
                    
                    if (log.data.distanceFromLast !== undefined) {
                        dataHtml += `<div class="distance">Mesafe: ${log.data.distanceFromLast.toFixed(2)}m</div>`;
                    }
                    
                    if (log.data.jumpDistance !== undefined && log.data.jumpDistance > 0) {
                        dataHtml += `<div class="jump-info">SÄ±Ã§rama: ${log.data.jumpDistance.toFixed(2)}m (${log.data.jumpType || 'minor'})</div>`;
                    }
                }
                
                return `
                    <div class="log-entry ${entryClass}">
                        <div class="log-entry-header">
                            <span class="log-entry-time">${log.time}</span>
                            <span class="log-entry-type ${typeClass}">${log.type}</span>
                        </div>
                        <div class="log-entry-data">
                            ${dataHtml}
                        </div>
                    </div>
                `;
            }).join('');
            
            // Scroll to top
            logContent.scrollTop = 0;
        }
        
        // Log gÃ¼ncelleme event listener
        window.addEventListener('locationLogUpdated', function(event) {
            updateLogDisplay();
        });
        
        // DOMContentLoaded olayÄ± en sonda tanÄ±mlanmalÄ±
        document.addEventListener('DOMContentLoaded', function() {
            // Sayfa tamamen yÃ¼klendikten 500ms sonra kontrol deÄŸiÅŸkenini global scope'a taÅŸÄ±
            setTimeout(() => {
                try {
                    // location-app.js'deki control deÄŸiÅŸkenini window nesnesine aktar
                    window.filterControl = control;
                    console.log("SimpleLocate kontrolÃ¼ window.filterControl'e aktarÄ±ldÄ± ve hazÄ±r.");

                    // Ä°lk bulunan kontrolÃ¼n parametrelerini al
                    const currentSettings = {};
                    Object.keys(defaultFilters).forEach(key => {
                        if (window.filterControl && window.filterControl.options) {
                            currentSettings[key] = window.filterControl.options[key];
                            // UI elemanlarÄ±nÄ± gÃ¼ncelleyelim
                            if (key === 'medianWindowSize' || key === 'kalmanProcessNoise' ||
                                key === 'kalmanMeasurementNoise' || key === 'jumpThreshold' ||
                                key === 'lowPassFilterTau') {

                                const input = document.getElementById(key);
                                if (input) {
                                    input.value = currentSettings[key];
                                    input.nextElementSibling.textContent = currentSettings[key];
                                }
                            } else if (key === 'enableFiltering' || key === 'enableLowPassFilter' ||
                                       key === 'showJumpWarnings') {

                                const checkbox = document.getElementById(key);
                                if (checkbox) {
                                    checkbox.checked = currentSettings[key];
                                }
                            }
                        }
                    });
                } catch (e) {
                    console.error("SimpleLocate kontrolÃ¼ne eriÅŸim saÄŸlanamadÄ±:", e);
                }
            }, 500);
        });
    </script>
</body>

</html>